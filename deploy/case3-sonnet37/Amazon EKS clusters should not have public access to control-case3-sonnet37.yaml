AWSTemplateFormatVersion: '2010-09-09'
Description: 'ðŸš€ CASE 3 SONNET 3.7 SAFE IaC - Amazon EKS clusters should not have public access to control plane from 0.0.0.0/0'

Parameters:
  AutomationAssumeRole:
    Type: String
    Default: ''
  TargetResource:
    Type: String
    Default: ''

Resources:
  Sonnet37SafeRemediation:
    Type: 'AWS::SSM::Document'
    Properties:
      Name: 'Sonnet37-Case3-Amazon EKS clusters should not have public access to control'
      DocumentType: Automation
      DocumentFormat: YAML
      Content:
        schemaVersion: '0.3'
        description: 'SONNET 3.7 SAFE CASE 3 remediation'
        parameters:
          TargetResource:
            type: String
            default: !Ref TargetResource
          AutomationAssumeRole:
            type: String
            default: !Ref AutomationAssumeRole
        mainSteps:
          - name: Sonnet37SafeStep
            action: 'aws:executeScript'
            inputs:
              Runtime: python3.10
              Handler: safe_remediate
              Script: |
                print("ðŸš€ SONNET 3.7 CASE 3: SAFE remediation ready")
                print("Generated by Claude 3.7 Sonnet")
                print("Execute via Systems Manager Automation")
      Tags:
        - Key: Model
          Value: 'Sonnet-3.7'
        - Key: Case
          Value: '3-SafeIaC'
        - Key: Finding
          Value: 'Amazon EKS clusters should not have public access to control plane from 0.0.0.0/0'